<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Atenxion Bank Credit Card Management Records</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f6f9;
      margin: 0;
      padding: 20px;
    }
    header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }
    header img {
      height: 50px;
      margin-right: 15px;
    }
    header h1 {
      margin: 0;
      font-size: 1.5rem;
    }
    button {
      background-color: #0052cc;
      color: white;
      border: none;
      padding: 10px 16px;
      font-size: 1rem;
      border-radius: 4px;
      cursor: pointer;
      margin-bottom: 15px;
    }
    #addForm {
      display: none;
      margin-bottom: 20px;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    form input {
      display: block;
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    form button {
      margin-right: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 12px;
      text-align: left;
    }
    th {
      background-color: #0052cc;
      color: white;
    }
    tr:nth-child(even) {
      background: #f9f9f9;
    }
    .status-active {
      background-color: #d4edda;
      color: #155724;
      font-weight: bold;
      padding: 6px 10px;
      border-radius: 4px;
    }
    .status-blocked {
      background-color: #f8d7da;
      color: #721c24;
      font-weight: bold;
      padding: 6px 10px;
      border-radius: 4px;
    }
    nav {
      margin-bottom: 20px;
    }
    nav .tab {
      margin-right: 10px;
    }
    nav .tab.active {
      background-color: #003a99;
    }
    #logFilters {
      margin-bottom: 15px;
    }
    #logFilters input, #logFilters select {
      margin-right: 10px;
      padding: 8px;
    }
  </style>
</head>
<body>

<header>
  <img src="https://www.atenxion.ai/_next/image?url=%2Fassets%2Fatenxion-black.png&w=256&q=75" alt="Logo">
  <h1>Atenxion Bank Credit Card Management</h1>
</header>

<nav>
  <button id="recordsTab" class="tab active">Records</button>
  <button id="ticketsTab" class="tab">Tickets</button>
  <button id="logsTab" class="tab">API Logs</button>
</nav>

<div id="recordsSection">
  <button id="showAddBtn">+ Add New Record</button>

  <div id="addForm">
    <form id="recordForm">
      <input name="name" placeholder="Name" required />
      <input name="dob" placeholder="DOB (YYYY-MM-DD)" required />
      <input name="nric" placeholder="NRIC" required />
      <input name="phone" placeholder="Phone Number" required />
      <input name="creditCardNumber" placeholder="Credit Card Number" required />
      <input name="creditCardType" placeholder="Credit Card Type" required />
      <input name="expiryDate" placeholder="Expiry Date (MM/YY)" required />
      <input name="status" placeholder="Status (Active/Blocked)" required />
      <input name="remark" placeholder="Remark (optional)" />
      <button type="submit">Save</button>
      <button type="button" id="cancelBtn">Cancel</button>
    </form>
  </div>

  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>DOB</th>
        <th>NRIC</th>
        <th>Phone</th>
        <th>Card #</th>
        <th>Type</th>
        <th>Expiry</th>
        <th>Status</th>
        <th>Remark</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="recordsBody"></tbody>
  </table>
</div>

<div id="ticketsSection" style="display:none;">
  <form id="ticketForm">
    <input name="description" placeholder="Description" required />
    <button type="submit">Create Ticket</button>
  </form>
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Description</th>
        <th>Status</th>
        <th>Update</th>
      </tr>
    </thead>
    <tbody id="ticketsBody"></tbody>
  </table>
</div>

<div id="logsSection" style="display:none;">
  <div id="logFilters">
    <input type="date" id="logFrom" />
    <input type="date" id="logTo" />
    <select id="logMethod">
      <option value="">All</option>
      <option value="GET">GET</option>
      <option value="POST">POST</option>
      <option value="PUT">PUT</option>
      <option value="DELETE">DELETE</option>
    </select>
    <button id="applyLogFilter">Apply</button>
  </div>
  <table>
    <thead>
      <tr>
        <th>Timestamp</th>
        <th>Method</th>
        <th>URL</th>
      </tr>
    </thead>
    <tbody id="logsBody"></tbody>
  </table>
</div>

<script>
  const showAddBtn = document.getElementById('showAddBtn');
  const addForm = document.getElementById('addForm');
  const cancelBtn = document.getElementById('cancelBtn');
  const form = document.getElementById('recordForm');
  const recordsBody = document.getElementById('recordsBody');
const recordsTab = document.getElementById('recordsTab');
const logsTab = document.getElementById('logsTab');
const recordsSection = document.getElementById('recordsSection');
const logsSection = document.getElementById('logsSection');
const ticketsTab = document.getElementById('ticketsTab');
const ticketsSection = document.getElementById('ticketsSection');
const ticketForm = document.getElementById('ticketForm');
const ticketsBody = document.getElementById('ticketsBody');
const logFrom = document.getElementById('logFrom');
const logTo = document.getElementById('logTo');
const logMethod = document.getElementById('logMethod');
const applyLogFilter = document.getElementById('applyLogFilter');
const logsBody = document.getElementById('logsBody');
let editingCardNumber = null;
let currentRecords = [];

  showAddBtn.onclick = () => {
    editingCardNumber = null;
    form.reset();
    form.creditCardNumber.disabled = false;
    addForm.style.display = 'block';
    showAddBtn.style.display = 'none';
  };

  cancelBtn.onclick = () => {
    form.reset();
    addForm.style.display = 'none';
    form.creditCardNumber.disabled = false;
    editingCardNumber = null;
    showAddBtn.style.display = 'inline-block';
  };

  recordsTab.onclick = () => {
    recordsSection.style.display = 'block';
    ticketsSection.style.display = 'none';
    logsSection.style.display = 'none';
    recordsTab.classList.add('active');
    ticketsTab.classList.remove('active');
    logsTab.classList.remove('active');
  };

  ticketsTab.onclick = () => {
    recordsSection.style.display = 'none';
    logsSection.style.display = 'none';
    ticketsSection.style.display = 'block';
    ticketsTab.classList.add('active');
    recordsTab.classList.remove('active');
    logsTab.classList.remove('active');
    loadTickets();
  };

  logsTab.onclick = () => {
    recordsSection.style.display = 'none';
    ticketsSection.style.display = 'none';
    logsSection.style.display = 'block';
    logsTab.classList.add('active');
    recordsTab.classList.remove('active');
    ticketsTab.classList.remove('active');
    loadLogs();
  };

  applyLogFilter.onclick = () => loadLogs();

  form.onsubmit = e => {
    e.preventDefault();
    const data = Object.fromEntries(new FormData(form).entries());

    if (editingCardNumber) {
      fetch(`/api/data/card/${editingCardNumber}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })
      .then(res => {
        if (!res.ok) throw new Error('Failed to update record');
        return res.json();
      })
      .then(() => {
        cancelBtn.onclick();
        loadData();
      })
      .catch(err => alert(err.message));
    } else {
      fetch('/records', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })
      .then(res => {
        if (!res.ok) throw new Error('Failed to add record');
        return res.json();
      })
      .then(() => {
        cancelBtn.onclick();
        loadData();
      })
      .catch(err => alert(err.message));
    }
  };

  ticketForm.onsubmit = e => {
    e.preventDefault();
    const data = Object.fromEntries(new FormData(ticketForm).entries());
    fetch('/api/tickets', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    })
    .then(() => {
      ticketForm.reset();
      loadTickets();
    })
    .catch(err => alert(err.message));
  };

  ticketsBody.addEventListener('click', e => {
    if (e.target.classList.contains('updateTicketBtn')) {
      const id = e.target.getAttribute('data-id');
      const select = ticketsBody.querySelector(`select[data-id="${id}"]`);
      const status = select.value;
      fetch(`/api/tickets/${id}/status`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ status })
      }).then(() => loadTickets());
    }
  });

  function loadData() {
    fetch('/records')
      .then(res => res.json())
      .then(data => {
        currentRecords = data;
        recordsBody.innerHTML = '';
        data.forEach(item => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${item.name}</td>
            <td>${item.dob}</td>
            <td>${item.nric}</td>
            <td>${item.phone || ''}</td>
            <td>${item.creditCardNumber}</td>
            <td>${item.creditCardType}</td>
            <td>${item.expiryDate}</td>
            <td><span class="${item.status.toLowerCase() === 'active' ? 'status-active' : 'status-blocked'}">${item.status}</span></td>
            <td>${item.remark || ''}</td>
            <td><button class="editBtn" data-card="${item.creditCardNumber}">Edit</button></td>
          `;
          recordsBody.appendChild(tr);
        });
      });
  }

  recordsBody.addEventListener('click', e => {
    if (e.target.classList.contains('editBtn')) {
      const card = e.target.getAttribute('data-card');
      const record = currentRecords.find(r => r.creditCardNumber === card);
      if (record) {
        editingCardNumber = card;
        addForm.style.display = 'block';
        showAddBtn.style.display = 'none';
        Object.keys(record).forEach(key => {
          if (form.elements[key]) {
            form.elements[key].value = record[key];
          }
        });
        form.creditCardNumber.disabled = true;
      }
    }
  });

  function loadTickets() {
    fetch('/api/tickets')
      .then(res => res.json())
      .then(data => {
        ticketsBody.innerHTML = '';
        data.forEach(ticket => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${ticket.id}</td>
            <td>${ticket.description}</td>
            <td>
              <select data-id="${ticket.id}" class="ticketStatus">
                ${['New','In Progress','Resolved'].map(s => `<option value="${s}" ${ticket.status === s ? 'selected' : ''}>${s}</option>`).join('')}
              </select>
            </td>
            <td><button data-id="${ticket.id}" class="updateTicketBtn">Update</button></td>
          `;
          ticketsBody.appendChild(tr);
        });
      });
  }

  function loadLogs() {
    const params = new URLSearchParams();
    if (logFrom.value) params.append('from', logFrom.value);
    if (logTo.value) params.append('to', logTo.value);
    if (logMethod.value) params.append('method', logMethod.value);
    fetch(`/api/logs?${params.toString()}`)
      .then(res => res.json())
      .then(data => {
        logsBody.innerHTML = '';
        data.forEach(log => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${log.timestamp}</td><td>${log.method}</td><td>${log.url}</td>`;
          logsBody.appendChild(tr);
        });
      });
  }

  loadData();
</script>

</body>
</html>
